/* ===================== è§’è‰²å‰æ™¯ç³»ç»Ÿ ===================== */
.character-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 500;
}

.character {
    position: absolute;
    height: 85vh;
    max-height: 700px;
    width: auto;
    pointer-events: auto;
    cursor: pointer;
    image-rendering: pixelated;
    filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5));
    transform-origin: bottom center;
    
    /* ä½¿ç”¨ç‹¬ç«‹çš„ transform å±æ€§ï¼ˆCSS Transform Level 2ï¼‰*/
    /* translate å’Œ scale å¯ä»¥è¢« transition æ§åˆ¶ */
    /* rotate å¯ä»¥è¢« animation æ§åˆ¶ */
    translate: var(--current-x, 0px) var(--current-y, 0px);
    scale: var(--current-scale, 1);
    
    /* ä½ç½®å’Œç¼©æ”¾çš„å¹³æ»‘è¿‡æ¸¡ */
    transition: translate 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                scale 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    
    /* æ‘†åŠ¨åŠ¨ç”»åªæ§åˆ¶ rotateï¼Œé€Ÿåº¦ç”± CSS å˜é‡æ§åˆ¶ */
    animation: char-sway var(--sway-duration, 4s) ease-in-out infinite;
}

/* æå°çš„æ‘†åŠ¨åŠ¨ç”»ï¼šåªæ§åˆ¶ rotate */
@keyframes char-sway {
    0%, 100% { rotate: 0deg; }
    50% { rotate: 1.5deg; }
}

/* Boss åœ¨å·¦è¾¹ */
.character-boss {
    left: 0;
    bottom: var(--boss-y, 0px);
    /* idle çŠ¶æ€ä½ç½® */
    --current-x: var(--boss-x, 80px);
    --current-y: 0px;
    --current-scale: var(--boss-scale, 1);
}

.character-boss.spin-active {
    /* spin çŠ¶æ€ä½ç½® */
    --current-x: var(--boss-spin-x, -200px);
}

/* Waiter åœ¨å³è¾¹ */
.character-waiter {
    right: 0;
    bottom: var(--waiter-y, 0px);
    /* idle çŠ¶æ€ä½ç½®ï¼ˆå³ä¾§å–åï¼‰ */
    --current-x: calc(-1 * var(--waiter-x, 80px));
    --current-y: 0px;
    --current-scale: var(--waiter-scale, 1);
}

.character-waiter.spin-active {
    /* spin çŠ¶æ€ä½ç½®ï¼ˆå³ä¾§å–åï¼‰ */
    --current-x: calc(-1 * var(--waiter-spin-x, -200px));
}

/* è§’è‰²æ‚¬åœæ•ˆæœ */
.character:hover {
    filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5)) brightness(1.1);
    /* æ‚¬åœæ—¶æš‚åœæ‘†åŠ¨ï¼Œé¿å…å¹²æ‰°ç‚¹å‡» */
    animation-play-state: paused;
}

.character:active {
    /* ç‚¹å‡»æ—¶è½»å¾®ç¼©å° */
    scale: calc(var(--current-scale, 1) * 0.98);
}

/* Waiter ç‰¹æ®Šæ‚¬åœï¼ˆå¯äº¤äº’æç¤ºï¼‰ */
.character-waiter:hover::after {
    content: 'ğŸ’';
    position: absolute;
    top: 10%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    animation: gem-float 1s ease-in-out infinite;
}

@keyframes gem-float {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-10px); }
}

/* ===================== CG æ›´æ–°åŠ¨ç”»ï¼ˆåƒç´ æ“¦é™¤æ•ˆæœï¼‰ ===================== */
.character.cg-updating {
    /* åŒæ—¶è¿è¡Œä¸¤ä¸ªåŠ¨ç”»ï¼šä¿ç•™ä½ç½®æ‘†åŠ¨ + åƒç´ æ“¦é™¤æ•ˆæœ */
    animation: char-sway 4s ease-in-out infinite, pixel-dissolve 0.6s steps(8) forwards;
}

@keyframes pixel-dissolve {
    /* åªæ”¹å˜ filter å’Œ clip-pathï¼Œä¸è§¦ç¢° transform */
    0% { 
        filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5)) contrast(1);
        clip-path: inset(0 0 0 0);
    }
    25% {
        filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5)) contrast(1.5) brightness(1.2);
        clip-path: polygon(0 0, 100% 0, 100% 25%, 75% 25%, 75% 50%, 50% 50%, 50% 75%, 25% 75%, 25% 100%, 0 100%);
    }
    50% {
        filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5)) contrast(2) brightness(1.5);
        clip-path: polygon(0 0, 50% 0, 50% 50%, 0 50%);
    }
    75% {
        filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5)) contrast(1.5) brightness(1.2);
    }
    100% {
        filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5)) contrast(1);
        clip-path: inset(0 0 0 0);
    }
}

/* ===================== æç¤ºå¼¹çª—ï¼ˆéæµè§ˆå™¨åŸç”Ÿï¼‰ ===================== */
.character-toast {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%) translateY(-20px);
    background: linear-gradient(180deg, #3E2723 0%, #1a0f0a 100%);
    border: 3px solid #5D4037;
    border-radius: 8px;
    padding: 15px 25px;
    color: #FFECB3;
    font-family: 'Press Start 2P', monospace;
    font-size: 12px;
    text-align: center;
    z-index: 2000;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease-out;
    box-shadow: 
        0 4px 15px rgba(0,0,0,0.6),
        inset 1px 1px 3px rgba(255,255,255,0.1);
}

.character-toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}

.character-toast .toast-icon {
    font-size: 24px;
    margin-bottom: 10px;
}

.character-toast .toast-text {
    line-height: 1.6;
}

.character-toast .toast-cost {
    color: #FF5252;
    margin-top: 5px;
}

/* ===================== Waiterå¯¹è¯æ°”æ³¡ ===================== */
.waiter-dialogue-bubble {
    position: fixed;
    min-width: 200px;
    max-width: 320px;
    background: #C0C0C0;
    border: 4px solid #1a1a1a;
    padding: 12px 16px;
    font-family: 'Press Start 2P', monospace;
    font-size: 14px;
    line-height: 1.6;
    color: #1a1a1a;
    z-index: 600;
    pointer-events: none;
    box-shadow: 
        0 4px 0 #808080,
        0 8px 0 #404040,
        4px 4px 8px rgba(0,0,0,0.5);
    transition: opacity 0.2s, transform 0.2s;
    transform-origin: bottom center;
}

.waiter-dialogue-bubble.hidden {
    opacity: 0;
    transform: translateY(10px) scale(0.9);
    pointer-events: none;
}

.waiter-dialogue-bubble:not(.hidden) {
    opacity: 1;
    transform: translateY(0) scale(1);
    animation: bubble-bounce 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes bubble-bounce {
    0% { transform: translateY(20px) scale(0.8); opacity: 0; }
    60% { transform: translateY(-5px) scale(1.05); }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

.bubble-text {
    position: relative;
    z-index: 1;
}

/* æ°”æ³¡å°¾å·´ï¼ˆæŒ‡å‘waiterï¼‰ */
.bubble-tail {
    position: absolute;
    bottom: -16px;
    right: 60px;
    width: 0;
    height: 0;
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 16px solid #C0C0C0;
    filter: drop-shadow(0 4px 0 #808080);
}

.bubble-tail::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: -14px;
    width: 0;
    height: 0;
    border-left: 14px solid transparent;
    border-right: 14px solid transparent;
    border-top: 18px solid #1a1a1a;
}
